var IexecOracle = artifacts.require("./IexecOracle.sol");
var IexecOracleAPIimpl = artifacts.require("./IexecOracleAPIimpl.sol");
var IexecOracleEscrow = artifacts.require("./IexecOracleEscrow.sol");
var RLC = artifacts.require("../node_modules/rlc-token//contracts/RLC.sol");




module.exports = function(deployer) {
  let aIexecOracleEscrowInstance;
  let aIexecOracleInstance;
  let rlcInstance;

  return deployer.deploy	(RLC, {gas: 1618444})
    .then(() => RLC.deployed())
    .then(instance => {
      rlcInstance = instance;
      return rlcInstance.unlock();
    })
    .then(() => deployer.deploy(IexecOracleEscrow, rlcInstance.address, {gas: 779576})) //RLC TOKEN ADRESS
    .then(() => IexecOracleEscrow.deployed())
    .then(instance => {
      aIexecOracleEscrowInstance = instance;
      console.log("IexecOracleEscrow deployed at address :" + instance.address);
      return deployer.deploy(IexecOracle, instance.address, '7000000000000000', {gas: 2726074}); //CALL BACK PRICE  2726074*1.2
    })
    .then(() => IexecOracle.deployed())
    .then(instance => {
      aIexecOracleInstance = instance;
      console.log("IexecOracle deployed at address :" + aIexecOracleInstance.address);
      return aIexecOracleEscrowInstance.changeIexecOracleRegistrationStatus(aIexecOracleInstance.address, true);
    })
    .then(() => console.log("IexecOracle registered in IexecOracleEscrow "));

};


/*
module.exports = function(deployer) {
  let aIexecOracleEscrowInstance;
  let aIexecOracleInstance;
  return deployer.deploy(IexecOracleEscrow, '0x607F4C5BB672230e8672085532f7e901544a7375') //RLC TOKEN ADRESS
    .then(() => IexecOracleEscrow.deployed())
    .then(instance => {
      aIexecOracleEscrowInstance =instance;
      console.log("IexecOracleEscrow deployed at address :" + instance.address);
      return deployer.deploy(IexecOracle, instance.address, '7000000000000000'); //CALL BACK PRICE
    })
    .then(() => IexecOracle.deployed())
    .then(instance => {
      aIexecOracleInstance =instance;
      console.log("IexecOracle deployed at address :" + aIexecOracleInstance.address);
      return aIexecOracleEscrowInstance.changeIexecOracleRegistrationStatus(aIexecOracleInstance.address, true);
    })
    .then(() => console.log("IexecOracle registered in IexecOracleEscrow "));
};
*/

/*
RLC TOKEN address :
kovan   = '0xc57538846ec405ea25deb00e0f9b29a432d53507'
rinkeby = '0xf1e6ad3a7ef0c86c915f0fedf80ed851809bea90'
ropsten = '0x7314dc4d7794b5e7894212ca1556ae8e3de58621'
mainnet = '0x607F4C5BB672230e8672085532f7e901544a7375'
 */
